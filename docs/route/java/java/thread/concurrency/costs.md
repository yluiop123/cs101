# 多线程应用的成本

从单线程应用程序过渡到多线程应用程序不仅带来好处，同时也有一些成本。不要仅仅因为可以就启用应用程序的多线程。你应该有充分的理由预期这样做带来的好处大于成本。如果有疑问，尝试测量应用程序的性能或响应能力，而不仅仅是猜测。

## 更复杂的设计
尽管多线程应用程序的某些部分比单线程应用程序更简单，但其他部分则更复杂。多线程访问共享数据的代码需要特别注意。线程交互远非总是简单的。由于线程同步不正确而引起的错误可能很难检测、重现和修复。

## 上下文切换开销
当CPU从一个线程的执行切换到执行另一个线程时，CPU需要保存当前线程的本地数据、程序指针等，并加载下一个要执行线程的本地数据、程序指针等。这个切换被称为“上下文切换”。CPU从一个线程的执行上下文切换到另一个线程的执行上下文。

上下文切换并不便宜。你不想不必要地在线程之间切换。

你可以在维基百科上阅读更多关于上下文切换的信息：
http://en.wikipedia.org/wiki/Context_switch

## 增加的资源消耗
线程需要从计算机获取一些资源才能运行。除了CPU时间外，线程还需要一些内存来保持其本地栈。它还可能占用操作系统内一些用于管理线程的资源。尝试创建一个创建100个线程的程序，这些线程除了等待什么都不做，看看应用程序在运行时占用多少内存。


